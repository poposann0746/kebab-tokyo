<div class="min-h-screen bg-amber-50 -mt-4 pb-12">

  <!-- ãƒ’ãƒ¼ãƒ­ãƒ¼ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <div class="relative overflow-hidden bg-stone-900 px-6 py-10 text-amber-50 text-center shadow-2xl">
    <div class="absolute inset-0 bg-[url('data:image/svg+xml;charset=utf-8,%3Csvg%20width%3D%2260%22%20height%3D%2260%22%20viewBox%3D%220%200%2060%2060%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Cg%20fill%3D%22none%22%20fill-rule%3D%22evenodd%22%3E%3Cg%20fill%3D%22%23ffffff%22%20fill-opacity%3D%220.08%22%3E%3Cpath%20d%3D%22M36%2034v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6%2034v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6%204V0H4v4H0v2h4v4h2V6h4V4H6z%22%2F%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fsvg%3E')] opacity-30"></div>
    <div class="relative">
      <p class="text-5xl mb-3">ğŸ¥™</p>
      <h1 class="text-3xl font-black tracking-tight">ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æŠ•ç¨¿</h1>
      <p class="mt-2 text-amber-200 text-sm font-medium"><%= @shop.name %> ã¸ã®è©•ä¾¡</p>
    </div>
  </div>

  <%= form_with model: [@shop, @review], class: "mx-auto max-w-lg px-4 -mt-6 relative z-10 space-y-6 pb-6" do |f| %>

    <!-- ã‚«ãƒ†ã‚´ãƒªé¸æŠã‚«ãƒ¼ãƒ‰ -->
    <div class="bg-white rounded-2xl shadow-lg p-6 border border-stone-200">
      <div class="flex items-center gap-2 mb-4">
        <span class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-stone-200 text-lg">ğŸ½ï¸</span>
        <span class="text-lg font-bold text-stone-800">ã‚«ãƒ†ã‚´ãƒª</span>
      </div>
      <%= f.hidden_field :category, id: "review_category" %>
      <div class="flex flex-wrap gap-2">
        <% [
          [:kebab_sand, "ğŸ¥™ ã‚±ãƒãƒ–ã‚µãƒ³ãƒ‰"],
          [:kebab_wrap, "ğŸŒ¯ ã‚±ãƒãƒ–ãƒ©ãƒƒãƒ—"],
          [:kebab_rice, "ğŸš ã‚±ãƒãƒ–ãƒ©ã‚¤ã‚¹"],
          [:other,      "ğŸ½ï¸ ãã®ä»–"]
        ].each do |value, label| %>
          <% selected = @review.category == value.to_s %>
          <button type="button"
                  id="category_chip_<%= value %>"
                  onclick="
                    document.getElementById('review_category').value = '<%= value %>';
                    document.querySelectorAll('[id^=category_chip_]').forEach(function(el) {
                      el.className = 'px-4 py-2.5 rounded-full text-sm font-bold border-2 transition-all duration-200 cursor-pointer bg-amber-50 text-amber-900 border-amber-300 hover:border-amber-600';
                    });
                    this.className = 'px-4 py-2.5 rounded-full text-sm font-bold border-2 transition-all duration-200 cursor-pointer bg-stone-900 text-amber-50 border-stone-900 shadow-md';
                  "
                  class="px-4 py-2.5 rounded-full text-sm font-bold border-2 transition-all duration-200 cursor-pointer
                         <%= selected ? 'bg-stone-900 text-amber-50 border-stone-900 shadow-md' : 'bg-amber-50 text-amber-900 border-amber-300 hover:border-amber-600' %>">
            <%= label %>
          </button>
        <% end %>
      </div>
    </div>

    <!-- è‚‰ã®ç¨®é¡é¸æŠã‚«ãƒ¼ãƒ‰ -->
    <div class="bg-white rounded-2xl shadow-lg p-6 border border-stone-200">
      <div class="flex items-center gap-2 mb-4">
        <span class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-stone-200 text-lg">ğŸ¥©</span>
        <span class="text-lg font-bold text-stone-800">è‚‰ã®ç¨®é¡</span>
      </div>
      <%= f.hidden_field :meat_type, id: "review_meat_type" %>
      <div class="flex flex-wrap gap-2">
        <% [
          [:beef,    "ğŸ„ ãƒ“ãƒ¼ãƒ•"],
          [:chicken, "ğŸ” ãƒã‚­ãƒ³"],
          [:mix,     "ğŸ– ãƒŸãƒƒã‚¯ã‚¹"],
          [:other,   "ğŸ½ï¸ ãã®ä»–"]
        ].each do |value, label| %>
          <% selected = @review.meat_type == value.to_s %>
          <button type="button"
                  id="meat_type_chip_<%= value %>"
                  onclick="
                    document.getElementById('review_meat_type').value = '<%= value %>';
                    document.querySelectorAll('[id^=meat_type_chip_]').forEach(function(el) {
                      el.className = 'px-4 py-2.5 rounded-full text-sm font-bold border-2 transition-all duration-200 cursor-pointer bg-amber-50 text-amber-900 border-amber-300 hover:border-amber-600';
                    });
                    this.className = 'px-4 py-2.5 rounded-full text-sm font-bold border-2 transition-all duration-200 cursor-pointer bg-stone-900 text-amber-50 border-stone-900 shadow-md';
                  "
                  class="px-4 py-2.5 rounded-full text-sm font-bold border-2 transition-all duration-200 cursor-pointer
                         <%= selected ? 'bg-stone-900 text-amber-50 border-stone-900 shadow-md' : 'bg-amber-50 text-amber-900 border-amber-300 hover:border-amber-600' %>">
            <%= label %>
          </button>
        <% end %>
      </div>
    </div>

    <!-- ã‚½ãƒ¼ã‚¹ã®ç¨®é¡é¸æŠã‚«ãƒ¼ãƒ‰ -->
    <div class="bg-white rounded-2xl shadow-lg px-4 py-6 border border-stone-200">
      <div class="flex items-center gap-2 mb-4 px-1">
        <span class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-stone-200 text-lg">ğŸ«™</span>
        <span class="text-lg font-bold text-stone-800">ã‚½ãƒ¼ã‚¹ã®ç¨®é¡</span>
      </div>
      <%= f.hidden_field :sauce_type, id: "review_sauce_type" %>
      <div class="flex gap-2 overflow-x-auto pb-2 -mx-1 px-1">
        <% [
          [:mild,          "ğŸ˜Š ãƒã‚¤ãƒ«ãƒ‰"],
          [:medium,        "ğŸŒ¶ï¸ ãƒŸãƒ‡ã‚£ã‚¢ãƒ "],
          [:hot,           "ğŸ”¥ ãƒ›ãƒƒãƒˆ"],
          [:very_hot,      "ğŸ’€ æ¿€è¾›"],
          [:yogurt,        "ğŸ¥› ãƒ¨ãƒ¼ã‚°ãƒ«ãƒˆ"],
          [:garlic_yogurt, "ğŸ§„ ã‚¬ãƒ¼ãƒªãƒƒã‚¯ãƒ¨ãƒ¼ã‚°ãƒ«ãƒˆ"],
          [:teriyaki,      "ğŸ¯ ãƒ†ãƒªãƒ¤ã‚­"],
          [:other,         "ğŸ½ï¸ ãã®ä»–"]
        ].each do |value, label| %>
          <% selected = @review.sauce_type == value.to_s %>
          <button type="button"
                  id="sauce_type_chip_<%= value %>"
                  onclick="
                    document.getElementById('review_sauce_type').value = '<%= value %>';
                    document.querySelectorAll('[id^=sauce_type_chip_]').forEach(function(el) {
                      el.className = 'min-w-20 px-4 py-1 rounded-xl text-xs font-bold border-2 transition-all duration-200 cursor-pointer bg-amber-50 text-amber-900 border-amber-300 hover:border-amber-600 text-center';
                    });
                    this.className = 'min-w-20 px-4 py-1 rounded-xl text-xs font-bold border-2 transition-all duration-200 cursor-pointer bg-stone-900 text-amber-50 border-stone-900 shadow-md text-center';
                  "
                  class="min-w-20 px-4 py-1 rounded-xl text-xs font-bold border-2 transition-all duration-200 cursor-pointer whitespace-nowrap shrink-0 text-center
                         <%= selected ? 'bg-stone-900 text-amber-50 border-stone-900 shadow-md' : 'bg-amber-50 text-amber-900 border-amber-300 hover:border-amber-600' %>">
            <%= label %>
          </button>
        <% end %>
      </div>
    </div>

    <!-- 5æ®µéšè©•ä¾¡ã‚«ãƒ¼ãƒ‰ -->
    <div class="bg-white rounded-2xl shadow-lg p-6 border border-stone-200 space-y-8">
      <div class="flex items-center gap-2 mb-2">
        <span class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-amber-100 text-lg">â­</span>
        <h2 class="text-lg font-bold text-stone-800">å„é …ç›®ã®è©•ä¾¡</h2>
      </div>

      <% [
        [:meat_taste,          "è‚‰ã®å‘³",       "ğŸ¥©", ["ğŸ˜¢", "ğŸ˜", "ğŸ™‚", "ğŸ˜‹", "ğŸ¤¤"]],
        [:sauce_taste,         "ã‚½ãƒ¼ã‚¹ã®å‘³",    "ğŸ«™", ["ğŸ˜¢", "ğŸ˜", "ğŸ™‚", "ğŸ˜‹", "ğŸ¤¤"]],
        [:vegetable_amount,    "é‡èœã®é‡",      "ğŸ¥¬", ["ğŸ˜¢", "ğŸ˜", "ğŸ™‚", "ğŸ˜‹", "ğŸ¤¤"]],
        [:bread_compatibility, "ãƒ‘ãƒ³ã¨ã®ç›¸æ€§",   "ğŸ«“", ["ğŸ˜¢", "ğŸ˜", "ğŸ™‚", "ğŸ˜‹", "ğŸ¤¤"]],
        [:value_for_money,     "ä¾¡æ ¼æº€è¶³åº¦",    "ğŸ’°", ["ğŸ˜¢", "ğŸ˜", "ğŸ™‚", "ğŸ˜‹", "ğŸ¤¤"]]
      ].each do |field, label, icon, emojis| %>

        <% current_value = @review.send(field) || 3 %>

        <div class="group">
          <div class="flex items-center justify-between mb-3">
            <label class="flex items-center gap-2 font-bold text-stone-700">
              <span class="text-xl"><%= icon %></span>
              <span><%= label %></span>
            </label>
            <div class="flex items-center gap-1.5">
              <span id="<%= field %>_emoji" class="text-2xl transition-all duration-300">
                <%= emojis[current_value - 1] %>
              </span>
              <span id="<%= field %>_value"
                    class="inline-flex items-center justify-center w-10 h-10 rounded-full
                           bg-amber-800 text-amber-50
                           text-lg font-black shadow-md">
                <%= current_value %>
              </span>
            </div>
          </div>

          <div class="relative">
            <%= f.range_field field,
                  min: 1,
                  max: 5,
                  step: 1,
                  value: current_value,
                  class: "w-full h-3 rounded-full appearance-none cursor-pointer
                         bg-amber-200
                         [&::-webkit-slider-thumb]:appearance-none
                         [&::-webkit-slider-thumb]:w-7
                         [&::-webkit-slider-thumb]:h-7
                         [&::-webkit-slider-thumb]:rounded-full
                         [&::-webkit-slider-thumb]:bg-white
                         [&::-webkit-slider-thumb]:border-4
                         [&::-webkit-slider-thumb]:border-amber-700
                         [&::-webkit-slider-thumb]:shadow-lg
                         [&::-webkit-slider-thumb]:transition-transform
                         [&::-webkit-slider-thumb]:duration-200
                         [&::-webkit-slider-thumb]:hover:scale-125
                         [&::-moz-range-thumb]:w-7
                         [&::-moz-range-thumb]:h-7
                         [&::-moz-range-thumb]:rounded-full
                         [&::-moz-range-thumb]:bg-white
                         [&::-moz-range-thumb]:border-4
                         [&::-moz-range-thumb]:border-amber-700
                         [&::-moz-range-thumb]:shadow-lg",
                  oninput: "
                    document.getElementById('#{field}_value').innerText = this.value;
                    var emojis = #{emojis.to_json};
                    document.getElementById('#{field}_emoji').innerText = emojis[this.value - 1];
                    document.getElementById('#{field}_emoji').style.transform = 'scale(1.4)';
                    setTimeout(function(){ document.getElementById('#{field}_emoji').style.transform = 'scale(1)'; }, 200);
                  " %>
            <div class="flex justify-between mt-1 px-1">
              <% (1..5).each do |n| %>
                <span class="text-xs text-amber-700 font-medium"><%= n %></span>
              <% end %>
            </div>
          </div>
        </div>

      <% end %>
    </div>

    <!-- ç·åˆè©•ä¾¡ã‚«ãƒ¼ãƒ‰ -->
    <% overall_value = @review.overall_score || 5 %>

    <div class="bg-amber-800 rounded-2xl shadow-2xl p-1">
      <div class="bg-white rounded-xl p-6">
        <div class="flex items-center justify-between mb-4">
          <div class="flex items-center gap-2">
            <span class="inline-flex items-center justify-center w-10 h-10 rounded-full bg-amber-800 text-xl shadow-md">ğŸ†</span>
            <label class="text-xl font-black text-stone-800">ç·åˆè©•ä¾¡</label>
          </div>
          <div class="flex items-baseline gap-1">
            <span id="overall_score_value"
                  class="text-4xl font-black text-amber-800">
              <%= overall_value %>
            </span>
            <span class="text-amber-700 font-bold text-lg">/ 10</span>
          </div>
        </div>

        <!-- æ•°å€¤ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ãƒ‰ãƒƒãƒˆ -->
        <div class="flex justify-center gap-1.5 mb-4" id="overall_dots">
          <% (1..10).each do |n| %>
            <div class="w-5 h-5 rounded-full transition-all duration-300 flex items-center justify-center text-[10px] font-bold
                        <%= n <= overall_value ? 'bg-amber-50 text-stone-900 border-2 border-stone-900 scale-110 shadow-sm' : 'bg-amber-200 text-amber-900 border border-amber-400' %>"
                 id="overall_dot_<%= n %>">
              <%= n %>
            </div>
          <% end %>
        </div>

        <%= f.range_field :overall_score,
              min: 1,
              max: 10,
              step: 1,
              value: overall_value,
              class: "w-full h-4 rounded-full appearance-none cursor-pointer
                     bg-amber-200
                     [&::-webkit-slider-thumb]:appearance-none
                     [&::-webkit-slider-thumb]:w-8
                     [&::-webkit-slider-thumb]:h-8
                     [&::-webkit-slider-thumb]:rounded-full
                     [&::-webkit-slider-thumb]:bg-white
                     [&::-webkit-slider-thumb]:border-4
                     [&::-webkit-slider-thumb]:border-stone-800
                     [&::-webkit-slider-thumb]:shadow-lg
                     [&::-webkit-slider-thumb]:transition-transform
                     [&::-webkit-slider-thumb]:duration-200
                     [&::-webkit-slider-thumb]:hover:scale-125
                     [&::-moz-range-thumb]:w-8
                     [&::-moz-range-thumb]:h-8
                     [&::-moz-range-thumb]:rounded-full
                     [&::-moz-range-thumb]:bg-white
                     [&::-moz-range-thumb]:border-4
                     [&::-moz-range-thumb]:border-stone-800
                     [&::-moz-range-thumb]:shadow-lg",
              oninput: "
                var v = parseInt(this.value);
                document.getElementById('overall_score_value').innerText = v;
                for (var i = 1; i <= 10; i++) {
                  var dot = document.getElementById('overall_dot_' + i);
                  if (i <= v) {
                    dot.className = 'w-5 h-5 rounded-full transition-all duration-300 flex items-center justify-center text-[10px] font-bold bg-amber-50 text-stone-900 border-2 border-stone-900 scale-110 shadow-sm';
                  } else {
                    dot.className = 'w-5 h-5 rounded-full transition-all duration-300 flex items-center justify-center text-[10px] font-bold bg-amber-200 text-amber-900 border border-amber-400';
                  }
                }
              " %>
        <div class="flex justify-between mt-1 px-1">
          <span class="text-xs text-amber-700 font-medium">ä½ã„</span>
          <span class="text-xs text-amber-700 font-medium">é«˜ã„</span>
        </div>
      </div>
    </div>

    <!-- ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚«ãƒ¼ãƒ‰ -->
    <div class="bg-white rounded-2xl shadow-lg p-6 border border-stone-200">
      <div class="flex items-center gap-2 mb-4">
        <span class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-amber-100 text-lg">ğŸ“¸</span>
        <span class="text-lg font-bold text-stone-800">å†™çœŸã‚’è¿½åŠ </span>
      </div>
      <div class="relative">
        <%= f.file_field :images,
              multiple: true,
              accept: "image/jpeg,image/png,image/webp",
              id: "review_images",
              class: "block w-full text-sm text-stone-700
                     file:mr-4 file:py-2.5 file:px-4
                     file:rounded-full file:border-2 file:border-amber-300
                     file:text-sm file:font-bold
                     file:bg-amber-50 file:text-amber-900
                     file:cursor-pointer
                     hover:file:bg-amber-100
                     file:transition-all file:duration-200",
              onchange: "
                var container = document.getElementById('image_preview_container');
                container.innerHTML = '';
                var files = this.files;
                if (files.length > 3) {
                  alert('ç”»åƒã¯æœ€å¤§3æšã¾ã§ã§ã™');
                  this.value = '';
                  return;
                }
                for (var i = 0; i < files.length; i++) {
                  var file = files[i];
                  if (file.size > 5 * 1024 * 1024) {
                    alert(file.name + ' ã¯5MBã‚’è¶…ãˆã¦ã„ã¾ã™');
                    this.value = '';
                    container.innerHTML = '';
                    return;
                  }
                  var reader = new FileReader();
                  reader.onload = function(e) {
                    var div = document.createElement('div');
                    div.className = 'relative w-24 h-24 rounded-xl overflow-hidden border-2 border-amber-200 shadow-sm';
                    var img = document.createElement('img');
                    img.src = e.target.result;
                    img.className = 'w-full h-full object-cover';
                    div.appendChild(img);
                    container.appendChild(div);
                  };
                  reader.readAsDataURL(file);
                }
              " %>
      </div>
      <div id="image_preview_container" class="flex gap-3 mt-4 flex-wrap"></div>
      <p class="mt-3 text-xs text-amber-700">æœ€å¤§3æšã¾ã§ / JPEG, PNG, WebP / 1æšã‚ãŸã‚Š5MBä»¥ä¸‹</p>
    </div>

    <!-- ã‚³ãƒ¡ãƒ³ãƒˆã‚«ãƒ¼ãƒ‰ -->
    <div class="bg-white rounded-2xl shadow-lg p-6 border border-stone-200">
      <div class="flex items-center gap-2 mb-4">
        <span class="inline-flex items-center justify-center w-8 h-8 rounded-full bg-amber-100 text-lg">ğŸ’¬</span>
        <%= f.label :comment, "ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆ", class: "text-lg font-bold text-stone-800" %>
      </div>
      <%= f.text_area :comment,
            rows: 5,
            placeholder: "ãŠåº—ã®æ„Ÿæƒ³ã‚’è‡ªç”±ã«æ›¸ã„ã¦ãã ã•ã„...",
            class: "w-full rounded-xl border-2 border-stone-300 px-4 py-3 text-stone-700
                    placeholder-amber-700/50 resize-none
                    focus:border-amber-700 focus:ring-4 focus:ring-amber-200 focus:outline-none
                    transition-all duration-200 bg-stone-50/30" %>
    </div>

    <!-- é€ä¿¡ãƒœã‚¿ãƒ³ -->
    <div class="pt-2">
      <%= f.submit "ğŸ¥™ ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æŠ•ç¨¿ã™ã‚‹",
            class: "w-full py-4 rounded-2xl text-lg font-black tracking-wide
                   text-amber-900 bg-amber-100 border-2 border-amber-800
                   shadow-xl shadow-amber-900/30
                   hover:text-white hover:bg-amber-800 hover:border-amber-900
                   hover:shadow-2xl hover:shadow-amber-900/50
                   hover:-translate-y-0.5
                   active:translate-y-0 active:shadow-lg
                   transition-all duration-300 cursor-pointer" %>
    </div>

    <!-- æˆ»ã‚‹ãƒªãƒ³ã‚¯ -->
    <div class="text-center">
      <%= link_to @shop, class: "inline-flex items-center gap-1 text-sm text-amber-800 hover:text-amber-900 transition-colors font-medium" do %>
        <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
        </svg>
        åº—èˆ—ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹
      <% end %>
    </div>

  <% end %>
</div>
